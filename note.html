<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <meta name="description" content="æ¡‰çš„ç¬”è®°æœ¬">
  <meta name="keywords" content="ç¬”è®°">
  <title>æ¡‰çš„ç¬”è®° </title>

  <!-- å¼•å…¥ä¸»æ ·å¼æ–‡ä»¶ -->
  <link rel="stylesheet" href="style.css" />
  
  <!-- ä¾èµ–ï¼ˆCDNï¼‰-->
  <script src="assets/marked.min.js"></script>
  
  <script src="assets/purify.min.js"></script>
  
  <link rel="stylesheet" href="assets/github.min.css">
  
  <script src="assets/highlight.min.js"></script>
  
  <!-- Markdown é˜…è¯»å™¨ä¸“ç”¨æ ·å¼ -->
  <style>
    /* æ–‡ä»¶æ ‘æ ·å¼ */
    .file-tree {
      font-size: var(--font-size-sm);
      line-height: 3;
      margin-bottom: var(--spacing-lg);
    }
    
    .folder, .file {
      cursor: pointer;
      user-select: none;
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      transition: background var(--transition-fast), color var(--transition-fast);
      margin-bottom: 4px;
    }
    
    .folder:hover, .file:hover {
      background: rgba(62, 80, 182, 0.08);
    }
    
    .folder .title {
      font-weight: 500;
      color: var(--color-accent);
    }
    
    .file.selected {
      background: rgba(62, 80, 182, 0.08);
      font-weight: 500;
    }
    
    .children {
      padding-left: 16px;
      margin-top: 4px;
      border-left: 1px dashed var(--color-border);
      max-height: 500px;
      overflow-y: hidden;
      transition: max-height var(--transition-normal);
    }
    
    .children.collapsed {
      max-height: 0;
    }

    /* å·¥å…·æ  */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: var(--spacing-md);
      flex-wrap: wrap;
    }
    
    .mobile-toggle {
      display: none;
      border: 1px solid var(--color-border);
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      background: var(--color-base);
      color: var(--color-text);
      cursor: pointer;
      font-size: var(--font-size-sm);
    }
    
    .search {
      flex: 1;
      min-width: 200px;
      padding: 10px 12px;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      background: var(--color-base);
      color: var(--color-text);
      outline: none;
      font-size: var(--font-size-sm);
      margin-bottom: var(--spacing-md);
    }
    
    .meta {
      min-width: 160px;
      color: var(--color-text-light);
      font-size: var(--font-size-xs);
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading-indicator {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(62, 80, 182, 0.2);
      border-radius: 50%;
      border-top-color: var(--color-accent);
      animation: spin 1s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Markdown å†…å®¹åŒºåŸŸ - å±…ä¸­ä¸”æ— è¾¹æ¡† */
    .md-content {
      padding: 0;
      box-sizing: border-box;
      width: 100%;
      max-width: 800px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢è¡Œè¿‡é•¿ */
      margin: 0 auto; /* å±…ä¸­æ˜¾ç¤º */
      border: none;
      background: transparent;
      box-shadow: none;
    }

    /* æ ‡é¢˜æ ·å¼ - ä¿æŒh1å±…ä¸­ï¼Œå…¶ä»–å·¦å¯¹é½ */
    .md-content h1 {
      text-align: center;
      font-size: var(--font-size-xl);
      margin: 0.6em 0 0.4em 0;
      color: var(--color-contrast);
      line-height: 6;
    }
    
    .md-content h2 {
      text-align: left;
      font-size: var(--font-size-lg);
      margin: 0.9em 0 0.35em 0;
      color: var(--color-contrast);
      line-height: 5;
    }
    
    .md-content h3 {
      text-align: left;
      font-size: 1.1rem;
      margin: 0.8em 0 0.35em 0;
      color: var(--color-contrast);
      line-height: 4;
    }
    
    .md-content h4 {
      text-align: left;
      font-size: 1rem;
      margin: 0.7em 0 0.3em 0;
      color: var(--color-contrast);
      line-height: 4;
    }
    
    .md-content h5 {
      text-align: left;
      font-size: 0.95rem;
      margin: 0.6em 0 0.25em 0;
      color: var(--color-contrast);
      line-height: 4;
    }
    
    .md-content h6 {
      text-align: left;
      font-size: 0.9rem;
      margin: 0.5em 0 0.2em 0;
      color: var(--color-contrast);
      line-height: 4;
    }

    /* æ­£æ–‡æ®µè½ä¸åˆ—è¡¨ - å·¦å¯¹é½ */
    .md-content p, .md-content li {
      text-align: left;
      color: var(--color-text);
      line-height: 2;
    }

    .md-content a {
      color: var(--color-accent);
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    
    .md-content a:hover {
      text-decoration: underline;
    }
    
    .md-content img {
      max-width: 100%;
      border-radius: var(--radius-sm);
    }

    .md-content blockquote {
      margin: 1em 0;
      padding: 12px 16px;
      border-left: 3px solid var(--color-accent);
      background: rgba(62, 80, 182, 0.08);
      color: var(--color-text);
      border-radius: var(--radius-sm);
    }
    
    .md-content hr {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: 22px 0;
    }
    
    .md-content ul, .md-content ol {
      padding-left: 1.3em;
    }
    
    .md-content li {
      margin: 0.35em 0;
    }
    
    .md-content table {
      border-collapse: collapse;
      width: 100%;
    }
    
    .md-content th, .md-content td {
      border: 1px solid var(--color-border);
      padding: 10px;
      text-align: left;
    }
    
    .md-content thead th {
      background: rgba(62, 80, 182, 0.08);
      font-weight: 500;
    }
    
    .md-content pre {
      background: #f6f8fa;
      color: var(--color-text);
      padding: 14px;
      border-radius: var(--radius-sm);
      overflow: auto;
      font-size: 0.9rem;
    }
    
    .md-content code {
      background: rgba(62, 80, 182, 0.08);
      color: var(--color-text);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
    }
    
    .md-content pre code {
      background: transparent;
      color: inherit;
      padding: 0;
      border-radius: 0;
    }

    /* é“¾æ¥å¡ç‰‡æ ·å¼ */
    .md-content a.md-link-card {
      display: inline-block;
      padding: 10px 14px;
      margin: 6px 6px 6px 0;
      background: rgba(62, 80, 182, 0.08);
      color: var(--color-accent);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(62, 80, 182, 0.2);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      text-decoration: none;
      transition: all var(--transition-fast);
      font-weight: 500;
      width: 100%;
    }
    
    .md-content a.md-link-card:hover, .md-content a.md-link-card:focus {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      text-decoration: none;
    }

    /* ç›®å½•æ ·å¼ï¼ˆåœ¨ä¾§è¾¹æ ä¸­ï¼‰ */
    .toc-section {
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--color-border);
      padding-top: var(--spacing-md);
    }
    
    .toc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .toc-title {
      font-weight: 500;
      font-size: var(--font-size-sm);
      color: var(--color-contrast);
    }
    
    .toc-toggle {
      border: 1px solid var(--color-border);
      background: var(--color-base);
      color: var(--color-text-light);
      border-radius: var(--radius-sm);
      padding: 4px 8px;
      cursor: pointer;
      font-size: var(--font-size-xs);
      transition: all var(--transition-fast);
    }
    
    .toc-toggle:hover {
      border-color: var(--color-accent);
    }
    
    .toc {
      overflow: auto;
      max-height: 300px;
      transition: max-height var(--transition-normal);
    }
    
    .toc.collapsed {
      max-height: 0;
      overflow: hidden;
    }

    .toc a {
      display: block;
      text-decoration: none;
      padding: 6px 8px;
      border-radius: var(--radius-sm);
      position: relative;
      color: var(--color-text-light);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
      margin-bottom: 2px;
    }
    
    .toc .level-1 {
      padding-left: 8px;
      color: var(--color-contrast);
      font-weight: 500;
    }
    
    .toc .level-2 {
      padding-left: 16px;
      color: var(--color-text);
    }
    
    .toc .level-3 {
      padding-left: 24px;
      color: var(--color-text-light);
    }
    
    .toc .level-4 {
      padding-left: 32px;
      color: var(--color-text-light);
    }
    
    .toc a:hover {
      background: rgba(62, 80, 182, 0.08);
      color: var(--color-text);
    }
    
    .toc a.active {
      background: rgba(62, 80, 182, 0.08);
      color: var(--color-accent);
      font-weight: 500;
    }

    /* ä¾§è¾¹æ  */
    .sidebar {
      position: fixed;
      left: -320px;
      top: 0;
      bottom: 0;
      z-index: 1000;
      width: 280px;
      background: var(--color-base);
      border-right: 1px solid var(--color-border);
      padding: var(--spacing-md);
      box-sizing: border-box;
      overflow-y: auto;
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar.open {
      left: 0;
    }
    
    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .close-btn {
      border: 0;
      background: transparent;
      color: var(--color-text-light);
      font-size: 24px;
      cursor: pointer;
      padding: 4px;
      line-height: 2;
    }
    
    .close-btn:hover {
      color: var(--color-text);
    }

    /* ç§»åŠ¨ç«¯ä¾§è¾¹æ æŒ‰é’® */
    .toc-fab {
      display: none;
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 100;
      border: 1px solid var(--color-border);
      background: var(--color-base);
      color: var(--color-text);
      border-radius: 50%;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      width: 48px;
      height: 48px;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    
    .toc-fab:hover {
      background: var(--color-accent);
      color: white;
      transform: scale(1.1);
    }
    
    .toc-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
      z-index: 999;
      backdrop-filter: blur(2px);
    }
    
    .toc-backdrop.open {
      display: block;
    }

    /* å¸ƒå±€ - ä¿®å¤PCç«¯å³ä¾§ç©ºç™½é—®é¢˜ */
    .md-layout {
      display: flex;
      gap: var(--spacing-xl);
      align-items: flex-start;
    }
    
    .md-main {
      flex: 1;
      min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
      width: 100%; /* ç¡®ä¿å æ»¡å¯ç”¨ç©ºé—´ */
    }
    
    /* ä¸»å®¹å™¨è°ƒæ•´ï¼Œç¡®ä¿å†…å®¹å±…ä¸­ */
    .main .container {
      display: flex;
      flex-direction: column;
      align-items: center; /* ä½¿å®¹å™¨å†…çš„æ‰€æœ‰å†…å®¹å±…ä¸­ */
    }

    /* ç©ºçŠ¶æ€æç¤º */
    .empty-state {
      text-align: center;
      : var(--spacing-xl);
      color: var(--color-text-light);
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-md);
      opacity: 0.3;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 980px) {
      .toc-fab {
        display: flex;
      }
    }

    @media (max-width: 767px) {
      .mobile-toggle {
        display: inline-block;
      }
      
      .search {
        min-width: 100%;
        order: 3;
      }
      
      .toolbar {
        gap: 8px;
      }
      
      .md-content {
        max-width: 100%; /* ç§»åŠ¨ç«¯å æ»¡å®½åº¦ */
        padding: 0 var(--spacing-sm);
      }
      
      .sidebar {
        width: 85%;
        max-width: 300px;
      }
    }

    @media (min-width: 981px) {
      /* PCç«¯ï¼šå›ºå®šä¾§è¾¹æ  */
      .sidebar {
        position: fixed;
        left: 0;
        width: 280px;
        height: calc(100vh - var(--header-height, 80px));
        top: var(--header-height, 80px);
        box-shadow: none;
        border-right: 1px solid var(--color-border);
        background: var(--color-base);
        z-index: 10;
      }
      
      .close-btn {
        display: none;
      }
      
      /* PCç«¯ä¸»å†…å®¹åŒºåŸŸå¸ƒå±€è°ƒæ•´ */
      .md-main {
        margin-left: 280px; /* ä¸ºä¾§è¾¹æ ç•™å‡ºç©ºé—´ */
        width: calc(100% - 280px); /* è®¡ç®—å‰©ä½™å®½åº¦ */
      }
      
      .md-content {
        max-width: 600px; /* é™åˆ¶å†…å®¹æœ€å¤§å®½åº¦ */
        margin: 0 auto; /* å±…ä¸­æ˜¾ç¤º */
      }
      
      .toolbar {
        width: 100%;
        max-width: 1200px; /* å·¥å…·æ ä¹Ÿé™åˆ¶æœ€å¤§å®½åº¦ */
        margin-left: auto;
        margin-right: auto;
      }
    }
    
    /* å½“ç›®å½•ä¸ºç©ºæ—¶çš„å¤„ç† */
    .toc:empty::before {
      content: "å½“å‰æœªåŠ è½½";
      color: var(--color-text-light);
      font-style: italic;
      font-size: var(--font-size-sm);
      display: block;
      padding: 12px;
    }
    
    /* ç©ºç›®å½•æ ·å¼ */
    .toc.empty-toc::before {
      content: "æœ¬æ–‡æ— æ ‡é¢˜";
      color: var(--color-text-light);
      font-style: italic;
      font-size: var(--font-size-sm);
      display: block;
      padding: 12px;
    }
    
    .sidebar-intro {
      font-size: var(--font-size-xs);
      color: var(--color-text-light);
      margin-top: 6px;
      margin-bottom: var(--spacing-sm);
    }
    
    /* æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯ */
    .file-stats {
      font-size: var(--font-size-xs);
      color: var(--color-text-light);
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.02);
      border-radius: var(--radius-sm);
      margin-top: var(--spacing-sm);
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <header class="header">
    <div class="container">
      <nav class="nav" aria-label="ä¸»å¯¼èˆª">
        <!-- å“ç‰Œ -->
        <div class="brand">
          <div class="brand-text">
            <h1><a href="index.html">An's web page</a></h1>
            <p class="tagline">æ¡‰çš„ç¬”è®°æœ¬</p>
          </div>
        </div>

        <!-- èœå•æŒ‰é’® -->
        <button
          class="nav-toggle"
          aria-label="åˆ‡æ¢å¯¼èˆªèœå•"
          aria-controls="primary-menu"
          aria-expanded="false"
          type="button"
        >â˜°</button>

        <!-- å¯¼èˆªèœå• -->
        <ul id="primary-menu" class="nav-menu" role="menu">
          <li role="none"><a role="menuitem" href="index.html"> é¦–é¡µ </a></li>
          <li role="none"><a role="menuitem" href="note.html"> ç¬”è®° </a></li>
          <li role="none"><a role="menuitem" href="alambda.html"> ALambda </a></li>
          <li role="none"><a role="menuitem" href="contact.html"> è”ç³» </a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- ä¾§è¾¹æ ï¼ˆæ–‡ä»¶åˆ—è¡¨å’Œç›®å½•ï¼‰ -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo" style="font-weight: 500; font-size: var(--font-size-sm);">æ¡‰çš„ç¬”è®°æœ¬</div>
      <button id="closeSidebar" class="close-btn" title="å…³é—­ä¾§è¾¹æ ">Ã—</button>
    </div>

    <input id="search" class="search" placeholder="æœç´¢ç¬”è®°..." />
    
    <div class="file-tree" id="fileTree">
      <div class="loading-indicator"></div> æ­£åœ¨åŠ è½½ç¬”è®°...
    </div>
    
    <!-- ç›®å½•åŒºåŸŸ -->
    <div class="toc-section">
      <div class="toc-header">
        <div class="toc-title">ç›®å½•</div>
        <button id="tocToggle" class="toc-toggle" aria-controls="toc" aria-label="æ”¶èµ·ç›®å½•">æ”¶èµ·</button>
      </div>
      <nav id="toc" class="toc">å½“å‰æœªåŠ è½½</nav>
    </div>
    
    <div class="file-stats" id="fileStats">
      å…±åŠ è½½ <span id="fileCount">0</span> ç¯‡ç¬”è®°
    </div>
  </aside>

  <main class="main">
    <div class="container">
      <div class="md-layout">
        <div class="md-main">
          <section class="md-content" id="content">
            <h1>Markdown é˜…è¯»å™¨</h1>
            <p>ä»å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª Markdown æ–‡ä»¶å¼€å§‹é˜…è¯»ã€‚</p>
            <p>æ­¤é˜…è¯»å™¨æ”¯æŒä»£ç é«˜äº®ã€ç›®å½•å¯¼èˆªã€å…¨æ–‡æœç´¢ç­‰åŠŸèƒ½ã€‚</p>
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“š</div>
              <p>é€‰æ‹©ä¸€ä¸ªç¬”è®°å¼€å§‹é˜…è¯»å§</p>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ æŒ‰é’® -->
  <button id="tocFab" class="toc-fab" aria-label="æ‰“å¼€ä¾§è¾¹æ ">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
  <div id="tocBackdrop" class="toc-backdrop" aria-hidden="true"></div>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>An's web page</h3>
          <p>æ¡‰çš„ä¸ªäººç½‘é¡µï¼Œåˆ†äº«è‰ºæœ¯ä½œå“ã€æŠ€æœ¯ç¬”è®°å’Œç”Ÿæ´»ç‚¹æ»´ã€‚</p>
        </div>

        <div class="footer-section">
          <h4>å¿«é€Ÿé“¾æ¥</h4>
          <ul class="footer-links">
            <li><a href="index.html">é¦–é¡µ</a></li>
            <li><a href="note.html">ç¬”è®°</a></li>
            <li><a href="alambda.html">ALambda</a></li>
            <li><a href="contact.html">è”ç³»</a></li>
          </ul>
        </div>
        
      <div class="copyright">
        <p>Â© 2025 AnmingCat</p>
      </div>
    </div>
  </footer>

  <!-- è„šæœ¬æ–‡ä»¶ -->
  <script src="script.js"></script>

  <!-- ç›´æ¥å¼•å…¥ manifest.jsï¼ˆå¿…é¡»åœ¨ä¸»è„šæœ¬å‰ï¼‰ -->
  <script src="./manifest.js"></script>

  <!-- å›é€€å†…åµŒ manifestï¼ˆå½“ manifest.js ä¸å­˜åœ¨æˆ–æœªå®šä¹‰ window.filesManifest æ—¶ä½¿ç”¨ï¼‰ -->
  <script type="application/json" id="embedded-manifest">
  {
    "README.md": "# Markdown é˜…è¯»å™¨\n\næ¬¢è¿ä½¿ç”¨ Markdown é˜…è¯»å™¨ï¼\n\nè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ Markdown é˜…è¯»å™¨ï¼Œæ”¯æŒï¼š\n\n- **ä»£ç é«˜äº®** - ä½¿ç”¨ Highlight.js\n- **ç›®å½•å¯¼èˆª** - è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç›®å½•\n- **æ–‡ä»¶æµè§ˆ** - ä»æ–‡ä»¶æ ‘ä¸­é€‰æ‹©æ–‡æ¡£\n- **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§è®¾å¤‡å±å¹•\n\n## åŠŸèƒ½ç¤ºä¾‹\n\n### ä»£ç å—\n\n```javascript\n// è¿™æ˜¯ä¸€ä¸ª JavaScript ç¤ºä¾‹\nfunction helloWorld() {\n  console.log('Hello, Markdown!');\n  return true;\n}\n```\n\n### è¡¨æ ¼\n\n| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |\n|------|------|------|\n| ä»£ç é«˜äº® | âœ… å·²æ”¯æŒ | ä½¿ç”¨ Highlight.js |\n| ç›®å½•å¯¼èˆª | âœ… å·²æ”¯æŒ | è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç›®å½• |\n| æ–‡ä»¶æœç´¢ | âœ… å·²æ”¯æŒ | æŒ‰æ–‡ä»¶åæˆ–å†…å®¹æœç´¢ |\n\n### å¼•ç”¨\n\n> Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ã€‚\n\n### åˆ—è¡¨\n\n- é¡¹ç›® 1\n- é¡¹ç›® 2\n  - å­é¡¹ç›® 2.1\n  - å­é¡¹ç›® 2.2\n- é¡¹ç›® 3\n\n### é“¾æ¥\n\n[è®¿é—® GitHub](https://github.com)\n\n### å›¾ç‰‡\n\n![ç¤ºä¾‹å›¾ç‰‡](https://via.placeholder.com/400x200.png?text=Markdown+Image)\n\n## å¼€å§‹ä½¿ç”¨\n\n1. ä»å·¦ä¾§æ–‡ä»¶æ ‘ä¸­é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£\n2. ä½¿ç”¨ç›®å½•å¿«é€Ÿå¯¼èˆª\n3. åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨å³ä¸‹è§’æŒ‰é’®æ‰“å¼€ç›®å½•\n"
  }
  </script>

  <!-- ä¸»è„šæœ¬ -->
  <script>
  (function(){
    const fileTreeEl = document.getElementById('fileTree');
    const contentEl = document.getElementById('content');
    const tocEl = document.getElementById('toc');
    const searchEl = document.getElementById('search');
    const sidebar = document.getElementById('sidebar');
    const closeSidebar = document.getElementById('closeSidebar');
    const tocToggle = document.getElementById('tocToggle');
    const tocFab = document.getElementById('tocFab');
    const tocBackdrop = document.getElementById('tocBackdrop');
    const fileStats = document.getElementById('fileStats');
    const fileCount = document.getElementById('fileCount');

    // è®¾ç½® header é«˜åº¦å˜é‡
    function updateHeaderHeight() {
      const header = document.querySelector('.header');
      if (header) {
        document.documentElement.style.setProperty('--header-height', header.offsetHeight + 'px');
      }
    }
    
    updateHeaderHeight();

    // ä¾§è¾¹æ å¼€å…³
    function openSidebar() {
      sidebar.classList.add('open');
      tocBackdrop.classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    
    function closeSidebarFn() {
      sidebar.classList.remove('open');
      tocBackdrop.classList.remove('open');
      document.body.style.overflow = '';
    }
    
    if (closeSidebar) closeSidebar.addEventListener('click', closeSidebarFn);
    
    // ç§»åŠ¨ç«¯ä¾§è¾¹æ æŒ‰é’®
    if (tocFab) {
      tocFab.addEventListener('click', openSidebar);
    }
    
    if (tocBackdrop) tocBackdrop.addEventListener('click', closeSidebarFn);

    // ç›®å½•å¼€å…³
    if (localStorage.getItem('mdviewer-toc-collapsed') === 'true') {
      tocEl.classList.add('collapsed');
      if (tocToggle) tocToggle.textContent = 'å±•å¼€';
    }
    
    if (tocToggle) {
      tocToggle.addEventListener('click', () => {
        const collapsed = tocEl.classList.toggle('collapsed');
        tocToggle.textContent = collapsed ? 'å±•å¼€' : 'æ”¶èµ·';
        localStorage.setItem('mdviewer-toc-collapsed', String(collapsed));
      });
    }

    // çª—å£å¤§å°å˜åŒ–æ—¶å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
    window.addEventListener('resize', () => {
      if (window.innerWidth > 980) {
        closeSidebarFn();
      }
      
      // æ›´æ–° header é«˜åº¦
      updateHeaderHeight();
    });

    const files = new Map();
    let selectedFileEl = null;
    let currentObserver = null;
    let searchTimeout = null;

    // æ›´æ–°æ–‡ä»¶ç»Ÿè®¡
    function updateFileStats() {
      if (fileCount) {
        fileCount.textContent = files.size;
      }
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading() {
      if (fileTreeEl) {
        fileTreeEl.innerHTML = '<div class="loading-indicator"></div> æ­£åœ¨åŠ è½½ç¬”è®°...';
      }
      if (contentEl) {
        contentEl.innerHTML = `
          <h1>åŠ è½½ä¸­...</h1>
          <div class="empty-state">
            <div class="loading-indicator" style="width: 24px; height: 24px;"></div>
            <p>æ­£åœ¨åŠ è½½ç¬”è®°å†…å®¹</p>
          </div>
        `;
      }
    }

    // åŠ è½½æ–‡ä»¶æ¸…å•
    function loadManifest() {
      showLoading();
      
      let manifest = null;
      if (window.filesManifest && typeof window.filesManifest === 'object') {
        manifest = window.filesManifest;
      } else {
        try {
          const embedded = document.getElementById('embedded-manifest');
          manifest = JSON.parse(embedded.textContent.trim());
        } catch (e) {
          manifest = {};
        }
      }

      const names = Object.keys(manifest);
      if (names.length === 0) {
        if (fileTreeEl) fileTreeEl.textContent = 'æœªæ‰¾åˆ°ä»»ä½•ç¬”è®°';
        if (contentEl) contentEl.innerHTML = `
          <h1>æ²¡æœ‰æ‰¾åˆ°ç¬”è®°</h1>
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <p>è¯·æ£€æŸ¥ manifest.js æ–‡ä»¶æˆ–æ·»åŠ ç¬”è®°å†…å®¹</p>
          </div>
        `;
        if (tocEl) {
          tocEl.innerHTML = '';
          tocEl.classList.add('empty-toc');
        }
        updateFileStats();
        return;
      }

      for (const name of names) {
        const raw = String(manifest[name] || '');
        files.set(name, { name, path: name, text: raw });
      }

      updateFileStats();
      buildTreeAndRender();

      // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰æŒ‡å®šçš„æ–‡ä»¶
      const urlParams = new URLSearchParams(window.location.search);
      const fileParam = urlParams.get('file');
      const hashParam = window.location.hash.slice(1);
      
      let firstFile = names[0];
      if (fileParam && files.has(fileParam)) {
        firstFile = fileParam;
      }

      requestAnimationFrame(() => {
        const nodeEl = document.querySelector(`.file[data-path="${CSS.escape(firstFile)}"]`);
        if (nodeEl) {
          nodeEl.click();
          // å¦‚æœæœ‰hashï¼Œæ»šåŠ¨åˆ°å¯¹åº”ä½ç½®
          if (hashParam && !fileParam) {
            setTimeout(() => {
              const target = document.getElementById(hashParam);
              if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
            }, 100);
          }
        }
      });
    }

    // æ„å»ºæ–‡ä»¶æ ‘æ¨¡å‹
    function buildTreeModel() {
      const root = {};
      for (const [p, meta] of files) {
        const parts = p.split('/').filter(Boolean);
        let node = root;
        for (let i = 0; i < parts.length; i++) {
          const part = parts[i];
          if (!node.children) node.children = {};
          if (!node.children[part]) node.children[part] = { 
            name: part, 
            path: parts.slice(0, i + 1).join('/'), 
            children: null 
          };
          node = node.children[part];
        }
        node.type = 'file';
        node.text = meta.text;
      }
      
      function convert(mapNode) {
        if (!mapNode || !mapNode.children) return [];
        return Object.values(mapNode.children).map(n => {
          if (n.children && Object.keys(n.children).length > 0) {
            return { 
              name: n.name, 
              path: n.path, 
              type: 'dir', 
              children: convert(n),
              collapsed: localStorage.getItem(`folder-${n.path}`) === 'true'
            };
          } else {
            return { 
              name: n.name, 
              path: n.path, 
              type: n.type === 'file' ? 'file' : 'dir', 
              text: n.text || '' 
            };
          }
        }).sort((a, b) => {
          if (a.type === b.type) return a.name.localeCompare(b.name, undefined, { sensitivity: 'base' });
          return a.type === 'dir' ? -1 : 1;
        });
      }
      
      return convert({ children: root.children || {} });
    }

    // æ¸²æŸ“æ–‡ä»¶æ ‘
    function renderTree(tree, container = fileTreeEl) {
      if (!container) return;
      container.innerHTML = '';
      if (!tree || tree.length === 0) {
        container.textContent = 'æœªæ‰¾åˆ°æ–‡ä»¶';
        return;
      }
      
      tree.forEach(node => {
        const el = document.createElement('div');
        if (node.type === 'dir') {
          const folder = document.createElement('div');
          folder.className = 'folder';
          folder.innerHTML = `<div class="title">â‹ ${node.name}</div>`;
          folder.addEventListener('click', (ev) => {
            ev.stopPropagation();
            const ch = el.querySelector('.children');
            if (ch) {
              const isCollapsed = ch.style.display === 'none';
              ch.style.display = isCollapsed ? 'block' : 'none';
              ch.classList.toggle('collapsed', !isCollapsed);
              localStorage.setItem(`folder-${node.path}`, !isCollapsed);
            }
          });
          el.appendChild(folder);
          const children = document.createElement('div');
          children.className = 'children';
          if (node.collapsed) {
            children.style.display = 'none';
            children.classList.add('collapsed');
          }
          renderTree(node.children || [], children);
          el.appendChild(children);
        } else {
          const file = document.createElement('div');
          file.className = 'file';
          file.innerHTML = `- ${node.name}`;
          file.dataset.path = node.path;
          file.tabIndex = 0;
          file.setAttribute('role', 'treeitem');
          file.addEventListener('click', () => selectFile(node.path, file));
          file.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              selectFile(node.path, file);
            }
          });
          el.appendChild(file);
        }
        container.appendChild(el);
      });
    }

    // é€‰æ‹©æ–‡ä»¶
    function selectFile(relPath, el) {
      if (selectedFileEl) selectedFileEl.classList.remove('selected');
      selectedFileEl = el;
      el.classList.add('selected');

      const entry = files.get(relPath);
      if (!entry) {
        contentEl.innerHTML = `
          <h1>æ–‡ä»¶ä¸å­˜åœ¨</h1>
          <div class="empty-state">
            <div class="empty-state-icon">Ã—</div>
            <p>æ— æ³•æ‰¾åˆ°æ–‡ä»¶: ${relPath}</p>
          </div>
        `;
        return;
      }
      
      // æ›´æ–°URLä½†ä¸åˆ·æ–°é¡µé¢
      const url = new URL(window.location);
      url.searchParams.set('file', relPath);
      history.replaceState(null, '', url);
      
      renderMarkdown(entry.text);
      
      // åœ¨ç§»åŠ¨ç«¯é€‰æ‹©æ–‡ä»¶åè‡ªåŠ¨å…³é—­ä¾§è¾¹æ 
      if (window.innerWidth <= 980) {
        closeSidebarFn();
      }
    }

    // æ¸²æŸ“ Markdown
    function renderMarkdown(md) {
      if (!contentEl) return;
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      contentEl.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <div class="loading-indicator" style="width: 24px; height: 24px; margin: 0 auto 20px;"></div>
          <p>æ­£åœ¨æ¸²æŸ“å†…å®¹...</p>
        </div>
      `;
      
      setTimeout(() => {
        marked.setOptions({ 
          gfm: true, 
          breaks: false, 
          smartLists: true, 
          headerIds: true,
          highlight: function(code, lang) {
            if (window.hljs && lang && hljs.getLanguage(lang)) {
              try {
                return hljs.highlight(code, { language: lang }).value;
              } catch (e) {}
            }
            return code;
          }
        });
        
        try {
          const html = marked.parse(md);
          const safe = DOMPurify.sanitize(html, { 
            ADD_ATTR: ['id', 'target', 'rel'],
            ADD_TAGS: ['iframe'],
            ADD_ATTR: ['allow', 'allowfullscreen', 'frameborder', 'scrolling']
          });
          contentEl.innerHTML = safe;

          // ä¸ºæ ‡é¢˜ç”Ÿæˆå”¯ä¸€ ID
          const headings = Array.from(contentEl.querySelectorAll('h1, h2, h3, h4, h5, h6'));
          headings.forEach(h => {
            const text = (h.textContent || '').trim();
            const base = text.slice(0, 40);
            const encoded = encodeURIComponent(base).replace(/%/g, '-').toLowerCase();
            const slug = encoded || ('section-' + h.tagName.toLowerCase());
            let id = slug;
            let i = 1;
            while (contentEl.querySelector('#' + CSS.escape(id))) {
              id = `${slug}-${i}`;
              i++;
            }
            h.id = id;
          });

          // ç”Ÿæˆç›®å½•
          let tocList = headings.filter(h => ['H2', 'H3', 'H4'].includes(h.tagName))
            .map(h => ({ text: h.textContent.trim(), level: parseInt(h.tagName.substring(1), 10), id: h.id }));
          if (tocList.length === 0) {
            tocList = headings.filter(h => h.tagName === 'H1').map(h => ({ text: h.textContent.trim(), level: 1, id: h.id }));
          }
          
          if (tocEl) {
            tocEl.innerHTML = '';
            tocEl.classList.remove('empty-toc');
            
            if (tocList.length === 0) {
              tocEl.classList.add('empty-toc');
            } else {
              tocList.forEach(item => {
                const a = document.createElement('a');
                a.href = '#' + item.id;
                a.textContent = item.text;
                a.className = 'level-' + item.level;
                a.addEventListener('click', (e) => {
                  e.preventDefault();
                  const target = document.getElementById(item.id);
                  if (!target) return;
                  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  history.replaceState(null, '', `#${item.id}`);
                  
                  // åœ¨ç§»åŠ¨ç«¯ç‚¹å‡»ç›®å½•åè‡ªåŠ¨å…³é—­ä¾§è¾¹æ 
                  if (window.innerWidth <= 980) {
                    closeSidebarFn();
                  }
                });
                tocEl.appendChild(a);
              });
            }
          }

          // ä»£ç é«˜äº®
          if (window.hljs) {
            const blocks = contentEl.querySelectorAll('pre code');
            if (blocks.length) {
              blocks.forEach(block => {
                hljs.highlightElement(block);
                // æ·»åŠ å¤åˆ¶æŒ‰é’®
                const pre = block.parentElement;
                if (pre && !pre.querySelector('.copy-btn')) {
                  const copyBtn = document.createElement('button');
                  copyBtn.className = 'copy-btn';
                  copyBtn.innerHTML = 'å¤åˆ¶';
                  copyBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    padding: 4px 8px;
                    background: rgba(0,0,0,0.1);
                    border: none;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    color: #666;
                  `;
                  copyBtn.addEventListener('click', async () => {
                    try {
                      await navigator.clipboard.writeText(block.textContent);
                      copyBtn.textContent = 'å·²å¤åˆ¶';
                      setTimeout(() => copyBtn.textContent = 'å¤åˆ¶', 2000);
                    } catch (err) {
                      console.error('å¤åˆ¶å¤±è´¥:', err);
                    }
                  });
                  pre.style.position = 'relative';
                  pre.appendChild(copyBtn);
                }
              });
            }
          }

          // ç›®å½•æ¿€æ´»è§‚å¯Ÿå™¨
          const observeTags = tocList.some(i => i.level >= 2) ? ['H2', 'H3', 'H4'] : ['H1'];
          const observeHeadings = headings.filter(h => observeTags.includes(h.tagName));
          const tocMap = new Map();
          if (tocEl) {
            tocEl.querySelectorAll('a').forEach(a => tocMap.set(a.getAttribute('href').slice(1), a));
          }
          
          if (currentObserver) {
            try {
              currentObserver.disconnect();
            } catch (e) {}
            currentObserver = null;
          }
          
          if (observeHeadings.length > 0) {
            currentObserver = new IntersectionObserver((entries) => {
              const visible = entries.filter(e => e.isIntersecting).sort((a, b) => a.target.getBoundingClientRect().top - b.target.getBoundingClientRect().top);
              const current = (visible[0] && visible[0].target.id) || null;
              if (!current) return;
              if (tocEl) tocEl.querySelectorAll('a.active').forEach(a => a.classList.remove('active'));
              const link = tocMap.get(current);
              if (link) link.classList.add('active');
            }, { rootMargin: '0px 0px -70% 0px', threshold: 0.1 });
            
            observeHeadings.forEach(h => currentObserver.observe(h));
          }

          // é“¾æ¥å¡ç‰‡æ ·å¼å¤„ç†
          renderPostProcessLinks();

          // åˆå§‹ hash å¤„ç†
          const initialHash = location.hash && location.hash.slice(1);
          if (initialHash) {
            const tgt = document.getElementById(initialHash);
            if (tgt) tgt.scrollIntoView({ behavior: 'auto', block: 'start' });
          }
        } catch (error) {
          console.error('æ¸²æŸ“Markdownæ—¶å‡ºé”™:', error);
          contentEl.innerHTML = `
            <h1>æ¸²æŸ“é”™è¯¯</h1>
            <div class="empty-state">
              <div class="empty-state-icon">âš ï¸</div>
              <p>æ— æ³•æ¸²æŸ“Markdownå†…å®¹</p>
              <pre style="text-align: left; background: #f8f8f8; padding: 10px; border-radius: 5px; margin-top: 10px;">${error.message}</pre>
            </div>
          `;
        }
      }, 50); // æ·»åŠ å¾®å°å»¶è¿Ÿç¡®ä¿UIå“åº”
    }

    // é“¾æ¥å¡ç‰‡å¤„ç†
    function renderPostProcessLinks() {
      if (!contentEl) return;
      const links = Array.from(contentEl.querySelectorAll('a'));
      links.forEach(a => {
        a.classList.add('md-link-card');
        try {
          const href = a.getAttribute('href') || '';
          if (/^https?:\/\//i.test(href)) {
            a.setAttribute('target', '_blank');
            a.setAttribute('rel', 'noopener noreferrer');
          }
        } catch (_) {}
      });
    }

    // æœç´¢åŠŸèƒ½ï¼ˆé˜²æŠ–å¤„ç†ï¼‰
    if (searchEl) {
      searchEl.addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          const q = searchEl.value.trim().toLowerCase();
          if (!q) {
            renderTree(buildTreeModel());
            return;
          }
          const matches = [];
          for (const [p, meta] of files) {
            if (p.toLowerCase().includes(q) || meta.name.toLowerCase().includes(q) || meta.text.toLowerCase().includes(q)) matches.push(p);
          }
          const tempFiles = new Map();
          for (const m of matches) tempFiles.set(m, files.get(m));
          const old = new Map(files);
          files.clear();
          for (const [k, v] of tempFiles) files.set(k, v);
          renderTree(buildTreeModel());
          files.clear();
          for (const [k, v] of old) files.set(k, v);
        }, 300);
      });
    }

    function buildTreeAndRender() {
      renderTree(buildTreeModel());
    }

    // é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('load', () => {
      loadManifest();
      
      // æ›´æ–° header é«˜åº¦
      updateHeaderHeight();
    });
    
    // ç›‘å¬popstateäº‹ä»¶ï¼ˆæµè§ˆå™¨å‰è¿›/åé€€ï¼‰
    window.addEventListener('popstate', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const fileParam = urlParams.get('file');
      if (fileParam && files.has(fileParam)) {
        const nodeEl = document.querySelector(`.file[data-path="${CSS.escape(fileParam)}"]`);
        if (nodeEl) nodeEl.click();
      }
    });
  })();
  </script>
</body>
</html>